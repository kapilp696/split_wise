<div class="container-fluid w-50 shadow mt-5 rounded border p-4 bg">
  <h1>New Group</h1>

  <%= form_with(model: [current_user, group], local: true) do |form| %>
    <% if @group.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@group.errors.count, "error") %> prohibited this group from being saved:</h2>

        <ul>
          <% @group.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="field form-outline mb-4 text-light">
      <%= form.label :name, "Name" %>
      <%= form.text_field :name, class: "form-control" %>
    </div> 

    <% unless group.persisted? %>
      <%= group.id %>
      <h3>Group Members</h3>
      <div id="group_memberships">
        <%= form.fields_for :group_memberships do |user_builder| %>
          <div class="nested-fields">
            <div class="field">
              <%= user_builder.label :user_id, 'Select User: ' %>
              <%= user_builder.collection_select :user_id, @users, :id, :email, { include_blank: true} %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <div class="actions">
      <%= form.submit :submit, class: "mb-2 text-light btn btn-dark mt-3" %>
    </div>
  <% end %>

  <% if @group.persisted? %>
    <h3>Current Members</h3>
    <div class="position-relative">
      <% @group.users.each do |user| %>
        <div class="m-3">
          <%= user.email %>
            <%= link_to "Remove", group_group_membership_path(@group, user.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "text-light btn btn-dark float-lg-end" %>       
        </div>
      <% end %>
    </div>
    <%= link_to 'Back', group_path(@group) %>
  <% else %>
    <%= link_to 'Back', root_path %>
  <% end %>  
</div>